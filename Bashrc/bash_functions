#!/bin/bash
#~/.bash_functions

. ~/.bash_cd

function cdg {
    TEMP_PWD=$PWD
    while [ ! -d .git ]
    do
            cd ..
    done
    OLDPWD=$TEMP_PWD
}

function gcp {
    # [g]it [c]ommit [p]ush
    cdg
    git add . && git commit -m "${1:-"Fast commit by Cuttlerat"}" && git push
    cd -
}

function gbc {

    git branch $1
    git checkout $1
    git push --set-upstream origin $1
}

function git_branch {
  git branch 2> /dev/null | sed -r '/^[^*]/d;s/\* (.*)/[\1]/'
}

function timer_start {
  timer=${timer:-$SECONDS}
}

function timer_stop {
  timer_show=$(($SECONDS - $timer))
  unset timer
}

function org {
    ORGPATH="$HOME/.org"
    if [[ $# -eq 0 ]]; then
        DAY=$(date +'%d')
        MONTH=$(date +'%m')
        YEAR=$(date +'%Y')
    elif [[ $# -eq 1 ]]; then
        INPUT="$@"
        DAY=$(awk -F'.' '$0=$1' <<< "${INPUT}" )
        MONTH=$(awk -F'.' '$0=$2' <<< "${INPUT}")
        YEAR=$(awk -F'.' '$0=$3' <<< "${INPUT}")
        [[ ${YEAR:="2017"} ]]
        [[ $(printf "${YEAR}" | wc -m) -eq 2 ]] && YEAR="20$YEAR"
    else
        echo "Usage: 'org' or 'org DD.MM' or 'org DD.MM.YY'"
        return
    fi
    mkdir -p "${ORGPATH}/${YEAR}/${MONTH}"
    emacs -nw "${ORGPATH}/${YEAR}/${MONTH}/${DAY}.org"
}
